<page-header [autoTitle]="false" [title]="null"></page-header>
<nz-skeleton [nzActive]="true" [nzTitle]="true" [nzParagraph]="{ rows: 10 }" [nzLoading]="!eruptBuildModel">
    <ng-container *ngIf="eruptBuildModel">
        <div>
            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.power.add">
                <button nz-button nzType="default" class="mb-sm" (click)="addRow()">
                    <i nz-icon type="plus" nzTheme="outline"></i>新增
                </button>
            </ng-container>

            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.power.delete">
                <button nz-button nzType="danger" class="mb-sm" (click)="delRows()">
                    <i nz-icon type="delete" nzTheme="outline"></i>删除
                </button>
            </ng-container>

            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.power.export">
                <button nz-button nzType="default" class="mb-sm" (click)="exportExcel()">
                    <i nz-icon type="download" nzTheme="outline"></i>下载
                </button>
            </ng-container>

            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.power.importable">
                &nbsp;
                <nz-dropdown-button (nzClick)="importableExcel()">
                    <i nz-icon nzType="import" nzTheme="outline"></i>
                    <span style="margin-left: 8px;">导入Excel</span>
                    <ul nz-menu>
                        <li nz-menu-item (click)="downloadExcelTemplate()">下载模板</li>
                    </ul>
                </nz-dropdown-button>
            </ng-container>

            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.power.query">
                <nz-divider nzType="vertical"></nz-divider>
                <button nz-button nzType="primary" class="mb-sm" (click)="query()">
                    <i nz-icon type="search" nzTheme="outline"></i>查询
                </button>
            </ng-container>

            <ng-container>
                <nz-divider nzType="vertical"></nz-divider>
                <button nz-button nzType="default" nz-popover
                        [(nzVisible)]="showColCtrl" [nzContent]="tableColumnCtrl"
                        nzTitle="表格列控制"
                        nzTrigger="click" class="mb-sm">
                    <i nz-icon nzType="table" nzTheme="outline"></i>表格列控制
                </button>
                <ng-template #tableColumnCtrl>
                    <div nz-row>
                        <ng-container *ngFor="let col of columns">
                            <div *ngIf="col.title&&col.index" nz-col nzSpan="6" style="min-width: 100px;">
                                <label nz-checkbox [(ngModel)]="col.show" (ngModelChange)="this.st.resetColumns()">{{col.title}}</label>
                            </div>
                        </ng-container>
                    </div>
                </ng-template>
            </ng-container>

            <ng-container *ngIf="searchErupt.eruptFieldModels&&searchErupt.eruptFieldModels.length>0">
                <div class="mb-sm float-right">
                    <button *ngIf="!hideCondition" nz-button (click)="clearCondition()">
                        <i nz-icon nzType="sync" nzTheme="outline"></i>重置条件
                    </button>
                    <button nz-button [nzType]="hideCondition?'default':'danger'"
                            (click)="hideCondition=!hideCondition">
                        <i nz-icon [type]="hideCondition?'codepen':'close'" nzTheme="outline"></i>
                    </button>
                </div>
            </ng-container>
        </div>
        <div>
            <ng-container *ngIf="eruptBuildModel.eruptModel.eruptJson.rowOperation">
                <ng-container *ngFor="let item of eruptBuildModel.eruptModel.eruptJson.rowOperation | keyvalue">
                    <ng-container *ngIf="item.value.multi">
                        <button nz-button nzType="dashed" class="mb-sm" (click)="gcOperator(item.key,true)">
                            <i class="fa" [ngClass]="item.value.icon"></i>
                            <span style="margin-left: 8px;">{{item.value.title}}</span>
                        </button>
                    </ng-container>
                </ng-container>
            </ng-container>
        </div>
        <nz-card *ngIf="searchErupt.eruptFieldModels&&searchErupt.eruptFieldModels.length>0" [nzBodyStyle]="{padding:'10px 5px'}"
                 style="background: #fafafa;margin-bottom: 0;box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.2)" [hidden]="hideCondition">
            <erupt-edit-type [eruptBuildModel]="{eruptModel:searchErupt,referenceErupts:eruptBuildModel.referenceErupts}"
                             [col]="{ xs: 24, sm: 24, md: 12, lg: 8, xl: 8, xxl: 6 }"
                             (search)="query()"
                             size="default"
                             layout="horizontal"
            >
            </erupt-edit-type>
        </nz-card>


        <!--y: 'calc(100vh - 400px)'-->
        <!--{x: (clientWidth > 768 ? eruptBuildModel.eruptModel.tableColumns.length * 110 : 0) + 'px'}-->
        <st #st
            [data]="stConfig.url" [columns]="columns"
            [scroll]="{x: '1000px'}"
            (change)="tableDataChange($event)"
            [bordered]="true"
            [multiSort]="stConfig.multiSort"
            [page]="stConfig.stPage"
            [req]="stConfig.req"
            [size]="'middle'">
        </st>
    </ng-container>
</nz-skeleton>