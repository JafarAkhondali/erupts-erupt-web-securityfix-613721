<div nz-row [nzGutter]="16">
    <form nz-form [nzLayout]="layout" [labelWidth]="100" se-container>
        <ng-container *ngFor="let field of eruptFieldModels">
            <ng-container *ngIf="field.eruptFieldJson.edit.show">
                <ng-container [ngSwitch]="field.eruptFieldJson.edit.type">
                    <ng-container *ngSwitchCase="editType.INPUT">
                        <ng-container [ngSwitch]="field.eruptFieldJson.edit.inputType[0].type">
                            <ng-container *ngSwitchCase="inputEnum.TEXT">
                                <div class="col-div" nz-col [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md"
                                     [nzLg]="col.lg"
                                     [nzXl]="col.xl"
                                     [nzXXl]="col.xxl">
                                    <se [label]="field.eruptFieldJson.edit.title"
                                        [required]="field.eruptFieldJson.edit.notNull"
                                        [optionalHelp]="field.eruptFieldJson.edit.desc">
                                        <ng-container
                                                *ngIf="field.fieldReturnName=='Integer'||field.fieldReturnName=='Double'||field.fieldReturnName=='Float'">
                                            <nz-input-number class="erupt-input" [nzSize]="size"
                                                             [nzDisabled]="field.eruptFieldJson.edit.readOnly"
                                                             [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                             [name]="field.fieldName"
                                                             [nzStep]="1"></nz-input-number>
                                        </ng-container>

                                        <ng-container
                                                *ngIf="field.fieldReturnName!=='Integer'&&field.fieldReturnName!=='Double'&&field.fieldReturnName!=='Float'">
                                            <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].prefix.length==0&&
                                                             field.eruptFieldJson.edit.inputType[0].suffix.length==0">
                                                <input nz-input [nzSize]="size" class="erupt-input" autocomplete="off"
                                                       [placeholder]="field.eruptFieldJson.edit.inputType[0].placeholder"
                                                       [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                       [name]="field.fieldName"
                                                       [required]="field.eruptFieldJson.edit.notNull"
                                                       [disabled]="field.eruptFieldJson.edit.readOnly">
                                            </ng-container>
                                            <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].prefix.length>0||
                                                             field.eruptFieldJson.edit.inputType[0].suffix.length>0">
                                                <nz-input-group
                                                        [nzAddOnBefore]="field.eruptFieldJson.edit.inputType[0].prefix.length>0&&addOnBeforeTemplate"
                                                        [nzAddOnAfter]="field.eruptFieldJson.edit.inputType[0].suffix.length>0&&addOnAfterTemplate"
                                                        [nzSize]="size" class="erupt-input">
                                                    <input nz-input autocomplete="off"
                                                           [placeholder]="field.eruptFieldJson.edit.inputType[0].placeholder"
                                                           [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                           [name]="field.fieldName"
                                                           [required]="field.eruptFieldJson.edit.notNull"
                                                           [disabled]="field.eruptFieldJson.edit.readOnly">
                                                </nz-input-group>
                                                <!--prefix and suffix template-->
                                                <ng-template #addOnBeforeTemplate>
                                                    <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].prefix.length==1">
                                                        {{field.eruptFieldJson.edit.inputType[0].prefix[0].label}}
                                                    </ng-container>
                                                    <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].prefix.length>1">
                                                        <nz-select [(ngModel)]="field.eruptFieldJson.edit.inputType[0].prefixValue"
                                                                   [name]="field.fieldName+'before'">
                                                            <ng-container *ngFor="let vl of field.eruptFieldJson.edit.inputType[0].prefix">
                                                                <nz-option [nzLabel]="vl.label" [nzValue]="vl.value"></nz-option>
                                                            </ng-container>
                                                        </nz-select>
                                                    </ng-container>
                                                </ng-template>
                                                <ng-template #addOnAfterTemplate>
                                                    <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].suffix.length==1">
                                                        {{field.eruptFieldJson.edit.inputType[0].suffix[0].label}}
                                                    </ng-container>
                                                    <ng-container *ngIf="field.eruptFieldJson.edit.inputType[0].suffix.length>1">
                                                        <nz-select [(ngModel)]="field.eruptFieldJson.edit.inputType[0].suffixValue"
                                                                   [name]="field.fieldName+'after'">
                                                            <ng-container *ngFor="let vl of field.eruptFieldJson.edit.inputType[0].suffix">
                                                                <nz-option [nzLabel]="vl.label" [nzValue]="vl.value"></nz-option>
                                                            </ng-container>
                                                        </nz-select>
                                                    </ng-container>
                                                </ng-template>
                                                <!--end prefix and suffix template-->
                                            </ng-container>
                                        </ng-container>
                                    </se>
                                </div>
                            </ng-container>

                            <ng-container *ngSwitchCase="inputEnum.TEXTAREA">
                                <div nz-col [nzSpan]="24">
                                    <se [label]="field.eruptFieldJson.edit.title"
                                        [required]="field.eruptFieldJson.edit.notNull"
                                        [optionalHelp]="field.eruptFieldJson.edit.desc">
                                        <textarea rows="4" nz-input class="erupt-input"
                                                  [value]="field.eruptFieldJson.edit.$value||''"
                                                  [required]="field.eruptFieldJson.edit.notNull"
                                                  [disabled]="field.eruptFieldJson.edit.readOnly"
                                        ></textarea>
                                    </se>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                    <!--choice-->
                    <ng-container *ngSwitchCase="editType.CHOICE">
                        <ng-container [ngSwitch]="field.eruptFieldJson.edit.choiceType[0].type">
                            <ng-container *ngSwitchCase="choiceEnum.RADIO">
                                <div nz-col [nzXs]="24">
                                    <se [label]="field.eruptFieldJson.edit.title"
                                        [required]="field.eruptFieldJson.edit.notNull"
                                        [optionalHelp]="field.eruptFieldJson.edit.desc">
                                        <nz-radio-group [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                        [name]="field.fieldName"
                                                        class="erupt-input stander-line-height">
                                            <ng-container *ngFor="let vl of field.eruptFieldJson.edit.choiceType[0].vl">
                                                <label nz-radio [nzValue]="vl.value">{{vl.label}}</label>
                                            </ng-container>
                                        </nz-radio-group>
                                    </se>
                                </div>
                            </ng-container>
                            <ng-container *ngSwitchCase="choiceEnum.CHECKBOX">
                                <div nz-col class="col-div" [nzXs]="24">
                                    <se [label]="field.eruptFieldJson.edit.title"
                                        [required]="field.eruptFieldJson.edit.notNull"
                                        [optionalHelp]="field.eruptFieldJson.edit.desc">
                                        <nz-checkbox-group [(ngModel)]="field.eruptFieldJson.edit.choiceType[0].vl">
                                        </nz-checkbox-group>
                                    </se>
                                </div>
                            </ng-container>
                            <ng-container *ngSwitchCase="choiceEnum.SELECT_SINGLE||choiceEnum.SELECT_MULTI">
                                <div nz-col class="col-div" [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md"
                                     [nzLg]="col.lg"
                                     [nzXl]="col.xl"
                                     [nzXXl]="col.xxl">
                                    <se [label]="field.eruptFieldJson.edit.title"
                                        [required]="field.eruptFieldJson.edit.notNull"
                                        [optionalHelp]="field.eruptFieldJson.edit.desc">
                                        <nz-select class="erupt-input" [nzAllowClear]='true'
                                                   [nzDisabled]="field.eruptFieldJson.edit.readOnly"
                                                   [nzSize]="size" [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                   [name]="field.fieldName"
                                                   [nzMode]="field.eruptFieldJson.edit.choiceType[0].type==choiceEnum.SELECT_MULTI?'multiple':'default'">
                                            <nz-option *ngFor="let vl of field.eruptFieldJson.edit.choiceType[0].vl"
                                                       [nzLabel]="vl.label" [nzValue]="vl.value"></nz-option>
                                        </nz-select>
                                    </se>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.SLIDER">
                        <div nz-col class="col-div" [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md" [nzLg]="col.lg"
                             [nzXl]="col.xl" [nzXXl]="col.xxl">
                            <se [label]="field.eruptFieldJson.edit.title"
                                [required]="field.eruptFieldJson.edit.notNull"
                                [optionalHelp]="field.eruptFieldJson.edit.desc">
                                <ng-container *ngIf="eruptModel.mode=='search'&&field.eruptFieldJson.edit.search.vague">
                                    <nz-slider class="erupt-input" nzRange
                                               [(ngModel)]="field.eruptFieldJson.edit.$value"
                                               [name]="field.fieldName"
                                               [nzMax]="field.eruptFieldJson.edit.sliderType[0].max"
                                               [nzMin]="field.eruptFieldJson.edit.sliderType[0].min"
                                               [nzDisabled]="field.eruptFieldJson.edit.readOnly"></nz-slider>
                                </ng-container>
                                <ng-container
                                        *ngIf="eruptModel.mode!='search'||!field.eruptFieldJson.edit.search.vague">
                                    <nz-slider class="erupt-input"
                                               [(ngModel)]="field.eruptFieldJson.edit.$value"
                                               [name]="field.fieldName"
                                               [nzMax]="field.eruptFieldJson.edit.sliderType[0].max"
                                               [nzMin]="field.eruptFieldJson.edit.sliderType[0].min"
                                               [nzDisabled]="field.eruptFieldJson.edit.readOnly"></nz-slider>
                                </ng-container>
                            </se>
                        </div>
                    </ng-container>
                    <!--date-->
                    <ng-container *ngSwitchCase="editType.DATE">
                        <div nz-col class="col-div" [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md" [nzLg]="col.lg"
                             [nzXl]="col.xl"
                             [nzXXl]="col.xxl">
                            <se [label]="field.eruptFieldJson.edit.title" [required]="field.eruptFieldJson.edit.notNull"
                                [optionalHelp]="field.eruptFieldJson.edit.desc">
                                <ng-container *ngIf="eruptModel.mode=='search'&&field.eruptFieldJson.edit.search.vague">
                                    <nz-range-picker [nzSize]="size" class="erupt-input stander-line-height"
                                                     [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                     [name]="field.fieldName">

                                    </nz-range-picker>
                                </ng-container>
                                <ng-container
                                        *ngIf="eruptModel.mode!='search'||!field.eruptFieldJson.edit.search.vague">
                                    <ng-container [ngSwitch]="field.eruptFieldJson.edit.dateType[0].type">
                                        <ng-container *ngSwitchCase="dateEnum.DAY">
                                            <nz-date-picker [nzSize]="size" class="erupt-input stander-line-height"
                                                            [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                            [name]="field.fieldName">

                                            </nz-date-picker>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="dateEnum.WEEK">
                                            <nz-week-picker [nzSize]="size" class="erupt-input stander-line-height"
                                                            [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                            [name]="field.fieldName">

                                            </nz-week-picker>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="dateEnum.MONTH">
                                            <nz-month-picker [nzSize]="size" class="erupt-input stander-line-height"
                                                             [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                             [name]="field.fieldName">

                                            </nz-month-picker>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="dateEnum.YEAR">
                                            <nz-year-picker [nzSize]="size" class="erupt-input stander-line-height"
                                                            [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                            [name]="field.fieldName">

                                            </nz-year-picker>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </se>
                        </div>
                    </ng-container>
                    <!--reference-->
                    <ng-container *ngSwitchCase="editType.REFERENCE">
                        <div class="stander-line-height">
                            <div nz-col class="col-div" [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md" [nzLg]="col.lg"
                                 [nzXl]="col.xl"
                                 [nzXXl]="col.xxl">
                                <se [label]="field.eruptFieldJson.edit.title"
                                    [required]="field.eruptFieldJson.edit.notNull"
                                    [optionalHelp]="field.eruptFieldJson.edit.desc">
                                    <nz-input-group [nzSize]="size" class="erupt-input" [nzAddOnAfter]="refBtn">
                                        <input nz-input [nzSize]="size" (click)="createRefModal(field)"
                                               [placeholder]="field.eruptFieldJson.edit.inputType[0].placeholder"
                                               [required]="field.eruptFieldJson.edit.notNull"
                                               [disabled]="true"
                                               [(ngModel)]="field.eruptFieldJson.edit.$viewValue"
                                               [name]="field.fieldName">
                                    </nz-input-group>
                                    <ng-template #refBtn>
                                        <ng-container *ngIf="field.eruptFieldJson.edit.$value">
                                            <i nz-icon type="close-circle" theme="fill" class="point" (click)="clearValue(field)"></i>
                                        </ng-container>
                                        <ng-container *ngIf="!field.eruptFieldJson.edit.$value">
                                            <i (click)="createRefModal(field)" nz-icon type="database" theme="fill" class="point"></i>
                                        </ng-container>
                                    </ng-template>
                                </se>
                            </div>
                        </div>
                    </ng-container>
                    <!--bool-->
                    <ng-container *ngSwitchCase="editType.BOOLEAN">
                        <div class="stander-line-height">
                            <div class="col-div" nz-col [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md" [nzLg]="col.lg"
                                 [nzXl]="col.xl"
                                 [nzXXl]="col.xxl">
                                <se [label]="field.eruptFieldJson.edit.title"
                                    [required]="field.eruptFieldJson.edit.notNull"
                                    [optionalHelp]="field.eruptFieldJson.edit.desc">
                                    <!--<nz-radio-group [(ngModel)]="field.eruptFieldJson.edit.$value" [nzSize]="size" class="erupt-input">-->
                                    <!--<label nz-radio-button [nzValue]="true">{{field.eruptFieldJson.edit.boolType[0].trueText}}</label>-->
                                    <!--<label nz-radio-button [nzValue]="null">不选</label>-->
                                    <!--<label nz-radio-button [nzValue]="false">{{field.eruptFieldJson.edit.boolType[0].falseText}}</label>-->
                                    <!--</nz-radio-group>-->
                                    <ng-container *ngIf="eruptModel.mode=='search'">
                                        <nz-radio-group [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                        [name]="field.fieldName"
                                                        class="erupt-input stander-line-height"
                                                        [nzButtonStyle]="'solid'">
                                            <label [nzValue]="null" nz-radio-button>全部</label>
                                            <label [nzValue]="true"
                                                   nz-radio-button>{{field.eruptFieldJson.edit.boolType[0].trueText}}</label>
                                            <label [nzValue]="false"
                                                   nz-radio-button>{{field.eruptFieldJson.edit.boolType[0].falseText}}</label>
                                        </nz-radio-group>
                                    </ng-container>
                                    <ng-container *ngIf="eruptModel.mode!='search'">
                                        <nz-switch class="erupt-input stander-line-height"
                                                   [(ngModel)]="field.eruptFieldJson.edit.$value"
                                                   [name]="field.fieldName"
                                                   [nzCheckedChildren]="field.eruptFieldJson.edit.boolType[0].trueText"
                                                   [nzUnCheckedChildren]="field.eruptFieldJson.edit.boolType[0].falseText"
                                                   [nzDisabled]="field.eruptFieldJson.edit.readOnly"
                                        ></nz-switch>
                                    </ng-container>
                                </se>
                            </div>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.DIVIDE">
                        <div nz-col [nzSpan]="24">
                            <nz-divider [nzDashed]="false" [nzText]="field.eruptFieldJson.edit.title"></nz-divider>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.IMAGE">
                        123
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.ATTACHMENT">
                        <div nz-col [nzSpan]="24">
                            <se [label]="field.eruptFieldJson.edit.title"
                                [required]="field.eruptFieldJson.edit.notNull"
                                [optionalHelp]="field.eruptFieldJson.edit.desc">
                                <ng-container [ngSwitch]="field.eruptFieldJson.edit.attachmentType[0].type">
                                    <ng-container *ngSwitchCase="attachmentEnum.IMAGE">
                                        <nz-upload
                                                [nzDisabled]="field.eruptFieldJson.edit.readOnly"
                                                [nzMultiple]="false"
                                                nzListType="picture-card"
                                                [(nzFileList)]="field.eruptFieldJson.edit.$tempValue"
                                                [nzLimit]="10"
                                                (nzChange)="upLoadNzChange($event,field)"
                                                [nzPreview]="previewImageHandler"
                                                [nzHeaders]="{token:tokenService.get().token}"
                                                [nzAction]="dataService.upload+this.eruptModel.eruptName+'/'+field.fieldName">
                                            <p class="ant-upload-drag-icon">
                                                <i nz-icon type="plus"></i>
                                            </p>
                                        </nz-upload>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="attachmentEnum.OTHER">
                                        <nz-upload
                                                nzType="drag"
                                                [nzDisabled]="field.eruptFieldJson.edit.readOnly"
                                                (nzChange)="upLoadNzChange($event,field)"
                                                [nzHeaders]="{token:tokenService.get().token}"
                                                [nzAction]="dataService.upload+this.eruptModel.eruptName+'/'+field.fieldName">
                                            <p class="ant-upload-drag-icon">
                                                <i nz-icon type="inbox"></i>
                                            </p>
                                            <p class="ant-upload-text">单击或拖动文件到此区域上传</p>
                                        </nz-upload>
                                    </ng-container>
                                </ng-container>
                            </se>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.MARK_DOWN">
                        <div nz-col [nzSpan]="24">
                            <se [label]="field.eruptFieldJson.edit.title"
                                [required]="field.eruptFieldJson.edit.notNull"
                                [optionalHelp]="field.eruptFieldJson.edit.desc">
                                <simplemde class="erupt-input" [(ngModel)]="field.eruptFieldJson.edit.$value"
                                           [name]="field.fieldName">
                                </simplemde>
                            </se>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="editType.EMPTY">
                        <div class="col-div" nz-col [nzXs]="col.xs" [nzSm]="col.sm" [nzMd]="col.md" [nzLg]="col.lg"
                             [nzXl]="col.xl"
                             [nzXXl]="col.xxl">

                        </div>
                    </ng-container>
                    <ng-container *ngSwitchDefault>

                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
    </form>
</div>

<nz-modal [nzVisible]="previewVisible" [nzContent]="modalContent" [nzFooter]="null" (nzOnCancel)="previewVisible=false"
          [nzWrapClassName]="'modal-lg'">
    <ng-template #modalContent>
        <img [src]="previewImage" [ngStyle]="{ 'width': '100%' }"/>
    </ng-template>
</nz-modal>